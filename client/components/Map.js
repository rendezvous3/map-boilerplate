import React, { useState } from "react";
import {
  GoogleMap,
  withScriptjs,
  withGoogleMap,
  Marker,
  InfoWindow
} from "react-google-maps";
import { compose, withProps } from "recompose";
import mapStyles from "./mapStyles";

const GOOGLE_MAP_KEY = "AIzaSyChkdWyYsS3XXiY83c_U_1ATu8De1KzUuM";

const SVG = `data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px"width="64" height="64"viewBox="0 0 172 172" style={{ fill: "#000000" }}><g transform="translate(11.696,11.696) scale(0.864,0.864)"><g fill="none" fill-rule="nonzero" stroke="none" stroke-width="none" stroke-linecap="butt" stroke-linejoin="none" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style={{mixBlendMode: "normal"}}><g stroke="#2e96cc" stroke-width="27" stroke-linejoin="round"><path d="M134.24063,70.68125c0,9.94375 -3.09062,19.48438 -8.86875,27.68125c0,0.13438 -0.13438,0.26875 -0.26875,0.26875l-37.0875,49.45c-0.5375,0.67188 -1.20938,1.075 -2.01562,1.075c-0.80625,0 -1.47812,-0.40312 -2.01562,-1.075l-36.95313,-49.18125l-0.13437,-0.13437c-0.13438,0 -0.13438,-0.13438 -0.26875,-0.26875c-5.77813,-8.19688 -8.86875,-17.87188 -8.86875,-27.81562c0.13438,-26.3375 21.76875,-47.8375 48.24063,-47.8375c26.60625,0 48.10625,21.5 48.24062,47.8375zM107.36563,69.20313c0,-11.42187 -9.54063,-20.55937 -21.36563,-20.55937c-11.825,0 -21.36562,9.1375 -21.36562,20.55937c0,11.2875 9.54062,20.55938 21.36562,20.55938c11.825,0 21.36563,-9.27188 21.36563,-20.55938z" fill="#5bbce2"></path><path d="M86,153.1875c-1.88125,0 -3.7625,-0.94063 -5.10625,-2.41875l-0.13437,-0.13438l-36.68438,-49.04688c-0.26875,-0.26875 -0.40312,-0.5375 -0.5375,-0.80625c-6.31563,-9.00312 -9.54063,-19.35 -9.54063,-30.1c0,-28.62188 23.38125,-51.86875 52.00313,-51.86875c28.75625,0 52.1375,23.38125 52.1375,52.00313c0,10.61563 -3.225,20.82813 -9.27187,29.69688c-0.26875,0.40312 -0.5375,0.80625 -0.94063,1.20938l-36.68437,48.77812l-0.13437,0.13438c-1.20938,1.6125 -3.09063,2.55312 -5.10625,2.55312zM50.12188,96.34688l0.13438,0.13438l35.74375,47.70312l35.87812,-47.8375c0.13438,-0.13437 0.26875,-0.26875 0.26875,-0.40312c5.10625,-7.39062 7.92813,-16.125 7.92813,-25.12813c0,-24.1875 -19.75313,-43.94062 -44.075,-43.94062c-24.1875,0 -44.075,19.61875 -44.20937,43.94063c0,9.00313 2.82188,17.7375 8.0625,25.2625c0.26875,0.13437 0.26875,0.26875 0.26875,0.26875z" fill="#454b54"></path><path d="M107.36563,69.20313c0,11.35463 -9.56572,20.55938 -21.36562,20.55938c-11.79991,0 -21.36562,-9.20475 -21.36562,-20.55938c0,-11.35463 9.56572,-20.55937 21.36562,-20.55937c11.79991,0 21.36562,9.20475 21.36562,20.55937z" fill="#c7d7e2"></path><path d="M86,93.79375c-13.975,0 -25.39687,-11.01875 -25.39687,-24.59063c0,-13.57187 11.42188,-24.725 25.39688,-24.725c13.975,0 25.39688,11.01875 25.39688,24.59063c0,13.57188 -11.42187,24.725 -25.39688,24.725zM86,52.54063c-9.54063,0 -17.33437,7.39063 -17.33437,16.52813c0,9.1375 7.79375,16.6625 17.33437,16.6625c9.54062,0 17.33438,-7.39062 17.33438,-16.52813c0,-9.1375 -7.79375,-16.6625 -17.33438,-16.6625z" fill="#454b54"></path></g><path d="M0,172v-172h172v172z" fill="none" stroke="none" stroke-width="1" stroke-linejoin="miter"></path><g stroke="none" stroke-width="1" stroke-linejoin="miter"><path d="M86,22.84375c-26.47188,0 -48.10625,21.5 -48.24062,47.8375c0,9.94375 3.09063,19.61875 8.86875,27.81562c0.13437,0.13437 0.13437,0.26875 0.26875,0.26875l0.13437,0.13437l36.95313,49.18125c0.5375,0.67188 1.20937,1.075 2.01562,1.075c0.80625,0 1.47812,-0.40312 2.01563,-1.075l37.0875,-49.45c0.13437,0 0.26875,-0.13437 0.26875,-0.26875c5.77813,-8.19687 8.86875,-17.7375 8.86875,-27.68125c-0.13438,-26.3375 -21.63437,-47.8375 -48.24062,-47.8375zM86,89.7625c-11.825,0 -21.36562,-9.27188 -21.36562,-20.55938c0,-11.42187 9.54062,-20.55937 21.36562,-20.55937c11.825,0 21.36563,9.1375 21.36563,20.55937c0,11.2875 -9.54063,20.55938 -21.36563,20.55938z" fill="#5bbce2"></path><path d="M86,153.1875c-1.88125,0 -3.7625,-0.94063 -5.10625,-2.41875l-0.13437,-0.13438l-36.68438,-49.04688c-0.26875,-0.26875 -0.40312,-0.5375 -0.5375,-0.80625c-6.31563,-9.00312 -9.54063,-19.35 -9.54063,-30.1c0,-28.62188 23.38125,-51.86875 52.00313,-51.86875c28.75625,0 52.1375,23.38125 52.1375,52.00313c0,10.61563 -3.225,20.82813 -9.27187,29.69688c-0.26875,0.40312 -0.5375,0.80625 -0.94063,1.20938l-36.68437,48.77812l-0.13437,0.13438c-1.20938,1.6125 -3.09063,2.55312 -5.10625,2.55312zM50.12188,96.34688l0.13438,0.13438l35.74375,47.70312l35.87812,-47.8375c0.13438,-0.13437 0.26875,-0.26875 0.26875,-0.40312c5.10625,-7.39062 7.92813,-16.125 7.92813,-25.12813c0,-24.1875 -19.75313,-43.94062 -44.075,-43.94062c-24.1875,0 -44.075,19.61875 -44.20937,43.94063c0,9.00313 2.82188,17.7375 8.0625,25.2625c0.26875,0.13437 0.26875,0.26875 0.26875,0.26875z" fill="#454b54"></path><path d="M86,48.64375c-11.79991,0 -21.36562,9.20475 -21.36562,20.55937c0,11.35463 9.56572,20.55938 21.36562,20.55938c11.79991,0 21.36562,-9.20475 21.36562,-20.55938c0,-11.35463 -9.56572,-20.55937 -21.36562,-20.55937z" fill="#c7d7e2"></path><path d="M86,93.79375c-13.975,0 -25.39687,-11.01875 -25.39687,-24.59063c0,-13.57187 11.42188,-24.725 25.39688,-24.725c13.975,0 25.39688,11.01875 25.39688,24.59063c0,13.57188 -11.42187,24.725 -25.39688,24.725zM86,52.54063c-9.54063,0 -17.33437,7.39063 -17.33437,16.52813c0,9.1375 7.79375,16.6625 17.33437,16.6625c9.54062,0 17.33438,-7.39062 17.33438,-16.52813c0,-9.1375 -7.79375,-16.6625 -17.33438,-16.6625z" fill="#454b54"></path></g><path d="" fill="none" stroke="none" stroke-width="1" stroke-linejoin="miter"></path></g></g></svg>`;
const SVG1 = `data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="64" height="64" viewBox="0 0 172 172"><g transform="translate(11.696,11.696) scale(0.864,0.864)"><g fill="none" fill-rule="nonzero" stroke="none" stroke-width="none" stroke-linecap="butt" stroke-linejoin="none" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none"><g stroke="#2e96cc" stroke-width="27" stroke-linejoin="round"><path d="M134.24063,70.68125c0,9.94375 -3.09062,19.48438 -8.86875,27.68125c0,0.13438 -0.13438,0.26875 -0.26875,0.26875l-37.0875,49.45c-0.5375,0.67188 -1.20938,1.075 -2.01562,1.075c-0.80625,0 -1.47812,-0.40312 -2.01562,-1.075l-36.95313,-49.18125l-0.13437,-0.13437c-0.13438,0 -0.13438,-0.13438 -0.26875,-0.26875c-5.77813,-8.19688 -8.86875,-17.87188 -8.86875,-27.81562c0.13438,-26.3375 21.76875,-47.8375 48.24063,-47.8375c26.60625,0 48.10625,21.5 48.24062,47.8375zM107.36563,69.20313c0,-11.42187 -9.54063,-20.55937 -21.36563,-20.55937c-11.825,0 -21.36562,9.1375 -21.36562,20.55937c0,11.2875 9.54062,20.55938 21.36562,20.55938c11.825,0 21.36563,-9.27188 21.36563,-20.55938z" fill="#5bbce2"></path><path d="M86,153.1875c-1.88125,0 -3.7625,-0.94063 -5.10625,-2.41875l-0.13437,-0.13438l-36.68438,-49.04688c-0.26875,-0.26875 -0.40312,-0.5375 -0.5375,-0.80625c-6.31563,-9.00312 -9.54063,-19.35 -9.54063,-30.1c0,-28.62188 23.38125,-51.86875 52.00313,-51.86875c28.75625,0 52.1375,23.38125 52.1375,52.00313c0,10.61563 -3.225,20.82813 -9.27187,29.69688c-0.26875,0.40312 -0.5375,0.80625 -0.94063,1.20938l-36.68437,48.77812l-0.13437,0.13438c-1.20938,1.6125 -3.09063,2.55312 -5.10625,2.55312zM50.12188,96.34688l0.13438,0.13438l35.74375,47.70312l35.87812,-47.8375c0.13438,-0.13437 0.26875,-0.26875 0.26875,-0.40312c5.10625,-7.39062 7.92813,-16.125 7.92813,-25.12813c0,-24.1875 -19.75313,-43.94062 -44.075,-43.94062c-24.1875,0 -44.075,19.61875 -44.20937,43.94063c0,9.00313 2.82188,17.7375 8.0625,25.2625c0.26875,0.13437 0.26875,0.26875 0.26875,0.26875z" fill="#454b54"></path><path d="M107.36563,69.20313c0,11.35463 -9.56572,20.55938 -21.36562,20.55938c-11.79991,0 -21.36562,-9.20475 -21.36562,-20.55938c0,-11.35463 9.56572,-20.55937 21.36562,-20.55937c11.79991,0 21.36562,9.20475 21.36562,20.55937z" fill="#c7d7e2"></path><path d="M86,93.79375c-13.975,0 -25.39687,-11.01875 -25.39687,-24.59063c0,-13.57187 11.42188,-24.725 25.39688,-24.725c13.975,0 25.39688,11.01875 25.39688,24.59063c0,13.57188 -11.42187,24.725 -25.39688,24.725zM86,52.54063c-9.54063,0 -17.33437,7.39063 -17.33437,16.52813c0,9.1375 7.79375,16.6625 17.33437,16.6625c9.54062,0 17.33438,-7.39062 17.33438,-16.52813c0,-9.1375 -7.79375,-16.6625 -17.33438,-16.6625z" fill="#454b54"></path></g><path d="M0,172v-172h172v172z" fill="none" stroke="none" stroke-width="1" stroke-linejoin="miter"></path><g stroke="none" stroke-width="1" stroke-linejoin="miter"><path d="M86,22.84375c-26.47188,0 -48.10625,21.5 -48.24062,47.8375c0,9.94375 3.09063,19.61875 8.86875,27.81562c0.13437,0.13437 0.13437,0.26875 0.26875,0.26875l0.13437,0.13437l36.95313,49.18125c0.5375,0.67188 1.20937,1.075 2.01562,1.075c0.80625,0 1.47812,-0.40312 2.01563,-1.075l37.0875,-49.45c0.13437,0 0.26875,-0.13437 0.26875,-0.26875c5.77813,-8.19687 8.86875,-17.7375 8.86875,-27.68125c-0.13438,-26.3375 -21.63437,-47.8375 -48.24062,-47.8375zM86,89.7625c-11.825,0 -21.36562,-9.27188 -21.36562,-20.55938c0,-11.42187 9.54062,-20.55937 21.36562,-20.55937c11.825,0 21.36563,9.1375 21.36563,20.55937c0,11.2875 -9.54063,20.55938 -21.36563,20.55938z" fill="#5bbce2"></path><path d="M86,153.1875c-1.88125,0 -3.7625,-0.94063 -5.10625,-2.41875l-0.13437,-0.13438l-36.68438,-49.04688c-0.26875,-0.26875 -0.40312,-0.5375 -0.5375,-0.80625c-6.31563,-9.00312 -9.54063,-19.35 -9.54063,-30.1c0,-28.62188 23.38125,-51.86875 52.00313,-51.86875c28.75625,0 52.1375,23.38125 52.1375,52.00313c0,10.61563 -3.225,20.82813 -9.27187,29.69688c-0.26875,0.40312 -0.5375,0.80625 -0.94063,1.20938l-36.68437,48.77812l-0.13437,0.13438c-1.20938,1.6125 -3.09063,2.55312 -5.10625,2.55312zM50.12188,96.34688l0.13438,0.13438l35.74375,47.70312l35.87812,-47.8375c0.13438,-0.13437 0.26875,-0.26875 0.26875,-0.40312c5.10625,-7.39062 7.92813,-16.125 7.92813,-25.12813c0,-24.1875 -19.75313,-43.94062 -44.075,-43.94062c-24.1875,0 -44.075,19.61875 -44.20937,43.94063c0,9.00313 2.82188,17.7375 8.0625,25.2625c0.26875,0.13437 0.26875,0.26875 0.26875,0.26875z" fill="#454b54"></path><path d="M86,48.64375c-11.79991,0 -21.36562,9.20475 -21.36562,20.55937c0,11.35463 9.56572,20.55938 21.36562,20.55938c11.79991,0 21.36562,-9.20475 21.36562,-20.55938c0,-11.35463 -9.56572,-20.55937 -21.36562,-20.55937z" fill="#c7d7e2"></path><path d="M86,93.79375c-13.975,0 -25.39687,-11.01875 -25.39687,-24.59063c0,-13.57187 11.42188,-24.725 25.39688,-24.725c13.975,0 25.39688,11.01875 25.39688,24.59063c0,13.57188 -11.42187,24.725 -25.39688,24.725zM86,52.54063c-9.54063,0 -17.33437,7.39063 -17.33437,16.52813c0,9.1375 7.79375,16.6625 17.33437,16.6625c9.54062,0 17.33438,-7.39062 17.33438,-16.52813c0,-9.1375 -7.79375,-16.6625 -17.33438,-16.6625z" fill="#454b54"></path></g><path d="" fill="none" stroke="none" stroke-width="1" stroke-linejoin="miter"></path></g></g></svg>`;

const Map = compose(
  withProps({
    loadingElement: <div style={{ height: "100%" }}></div>,
    containerElement: <div style={{ height: "100%" }}></div>,
    mapElement: <div style={{ height: "100%" }}></div>,
    googleMapURL: `https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=geometry,drawing,places&key=${GOOGLE_MAP_KEY}`
  }),
  withScriptjs,
  withGoogleMap
)(props => {
  let { markers } = props;
  // console.log("MARKERS", markers)

  const [selectedMarker, setSelectedMarker] = useState(null);

  return (
    <GoogleMap
      defaultZoom={12}
      defaultCenter={{ lat: 45.42042, lng: -75.69243 }}
      defaultOptions={{ styles: mapStyles }}
    >
      {markers &&
        markers.map(m => {
          const lat = m.coordinates[1];
          const lng = m.coordinates[0];
          let markerColor = "/v10.png";
          let markerSize = 70;
          if(selectedMarker) {
            if(m.PARK_ID === selectedMarker.PARK_ID) {
              markerColor = "/v12.png";
              markerSize = 85;
              // changeMarkerToBlue();
            } 
          }
          return (
            <Marker
              key={m.PARK_ID}
              position={{ lat, lng }}
              onMouseOver={() => setSelectedMarker(m) }
              onMouseOut={() => setSelectedMarker(null) }
              icon={{
                // url: SVG1
                // url: "https://img.icons8.com/cotton/64/000000/place-marker.png",
                // url: markerURL,
                url: markerColor,
                scaledSize: new window.google.maps.Size(markerSize, markerSize)
              }}
              onClick={() => {
                setSelectedMarker(m);
              }}
            />
          );
        })}

      {/* {selectedMarker && (
        <InfoWindow
          position={{
            // lat: selectedMarker.coordinates[1] + 0.012,
            lat: selectedMarker.coordinates[1],
            lng: selectedMarker.coordinates[0]
          }}
          onCloseClick={() => {
            setSelectedMarker(null);
          }}
        >
          <div className="info-window">
            <h2 className="info-window-title">{selectedMarker.NAME}</h2>
          </div>
        </InfoWindow>
      )} */}
    </GoogleMap>
  );
});

export default Map;
